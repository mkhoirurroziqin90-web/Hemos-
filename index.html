<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEMOS - Healthy Monitoring System</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: 'Poppins', sans-serif; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        /* Animated Background */
        .animated-bg {
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #0f0c29);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 15s infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }
        
        /* Glass Effect */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        /* Glowing Effects */
        .glow-blue { box-shadow: 0 0 30px rgba(59, 130, 246, 0.5); }
        .glow-red { box-shadow: 0 0 30px rgba(239, 68, 68, 0.5); }
        .glow-green { box-shadow: 0 0 30px rgba(34, 197, 94, 0.5); }
        .glow-orange { box-shadow: 0 0 30px rgba(249, 115, 22, 0.5); }
        .glow-purple { box-shadow: 0 0 30px rgba(168, 85, 247, 0.5); }
        
        /* Pulse Animation */
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            80%, 100% { transform: scale(1.3); opacity: 0; }
        }
        
        /* Heartbeat Animation */
        .heartbeat {
            animation: heartbeat 1s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1); }
            75% { transform: scale(1.05); }
        }
        
        /* Wave Animation */
        .wave-container {
            position: relative;
            overflow: hidden;
        }
        
        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: 50% 100px;
            animation: wave 10s linear infinite;
        }
        
        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        /* Status Colors */
        .status-normal { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        .status-low { 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        .status-high { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }
        
        /* Card Hover Effect */
        .sensor-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .sensor-card:hover {
            transform: translateY(-10px) scale(1.02);
        }
        
        /* Progress Ring */
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
        
        /* Live Indicator */
        .live-dot {
            animation: live-pulse 2s ease-in-out infinite;
        }
        
        @keyframes live-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Input Focus Effect */
        .input-glow:focus {
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
        }
        
        /* Button Shine Effect */
        .btn-shine {
            position: relative;
            overflow: hidden;
        }
        
        .btn-shine::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .btn-shine:hover::before {
            left: 100%;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.8);
        }
        
        /* Number Counter Animation */
        .counter {
            display: inline-block;
        }
    </style>
</head>
<body class="min-h-screen animated-bg">
    
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Landing Page -->
    <div id="landingPage" class="page active min-h-screen flex items-center justify-center p-4 relative z-10">
        <div class="glass-card rounded-3xl p-8 md:p-12 max-w-lg w-full text-center relative overflow-hidden">
            <!-- Decorative Elements -->
            <div class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-full blur-3xl"></div>
            <div class="absolute bottom-0 left-0 w-40 h-40 bg-gradient-to-tr from-blue-500/20 to-cyan-500/20 rounded-full blur-3xl"></div>
            
            <div class="relative z-10">
                <!-- Logo -->
                <div class="mb-8">
                    <div class="w-28 h-28 mx-auto bg-gradient-to-br from-violet-600 via-purple-600 to-indigo-600 rounded-3xl flex items-center justify-center mb-6 shadow-2xl glow-purple heartbeat">
                        <i class="fas fa-heartbeat text-5xl text-white"></i>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-black bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent">HEMOS</h1>
                    <p class="text-gray-500 mt-2 text-lg font-medium">Healthy Monitoring System</p>
                </div>
                
                <!-- Features -->
                <div class="flex justify-center gap-6 mb-8">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-heart text-red-500"></i>
                        </div>
                        <p class="text-xs text-gray-500">BPM</p>
                    </div>
                    <div class="text-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-lungs text-blue-500"></i>
                        </div>
                        <p class="text-xs text-gray-500">SpO2</p>
                    </div>
                    <div class="text-center">
                        <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-thermometer-half text-orange-500"></i>
                        </div>
                        <p class="text-xs text-gray-500">Suhu</p>
                    </div>
                </div>
                
                <p class="text-gray-600 mb-8 leading-relaxed">Pantau kesehatan Anda secara <span class="font-semibold text-purple-600">real-time</span> dengan teknologi IoT terkini. Monitoring BPM, SpO2, dan Suhu tubuh dengan akurat.</p>
                
                <div class="space-y-4">
                    <button onclick="showPage('loginPage')" class="btn-shine w-full py-4 px-6 bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600 text-white rounded-2xl font-bold text-lg hover:shadow-xl hover:shadow-purple-500/30 transition-all duration-300 transform hover:scale-[1.02]">
                        <i class="fas fa-sign-in-alt mr-2"></i> Masuk
                    </button>
                    <button onclick="showPage('registerPage')" class="w-full py-4 px-6 bg-white border-2 border-purple-500 text-purple-600 rounded-2xl font-bold text-lg hover:bg-purple-50 transition-all duration-300">
                        <i class="fas fa-user-plus mr-2"></i> Daftar Akun Baru
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="page min-h-screen flex items-center justify-center p-4 relative z-10">
        <div class="glass-card rounded-3xl p-8 max-w-md w-full relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600"></div>
            
            <button onclick="showPage('landingPage')" class="flex items-center gap-2 text-gray-500 hover:text-purple-600 mb-6 transition-colors">
                <i class="fas fa-arrow-left"></i>
                <span>Kembali</span>
            </button>
            
            <div class="text-center mb-8">
                <div class="w-16 h-16 mx-auto bg-gradient-to-br from-violet-600 to-indigo-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
                    <i class="fas fa-user text-2xl text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Selamat Datang!</h2>
                <p class="text-gray-500 mt-1">Masuk ke akun Anda</p>
            </div>
            
            <form id="loginForm" class="space-y-5">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-user text-purple-500 mr-2"></i>Username
                    </label>
                    <input type="text" id="loginUsername" required 
                        class="input-glow w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:bg-white outline-none transition-all duration-300" 
                        placeholder="Masukkan username">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-lock text-purple-500 mr-2"></i>Password
                    </label>
                    <div class="relative">
                        <input type="password" id="loginPassword" required 
                            class="input-glow w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:bg-white outline-none transition-all duration-300" 
                            placeholder="Masukkan password">
                        <button type="button" onclick="togglePassword('loginPassword', this)" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-purple-500">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn-shine w-full py-4 px-6 bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600 text-white rounded-xl font-bold text-lg hover:shadow-xl hover:shadow-purple-500/30 transition-all duration-300 mt-6">
                    <i class="fas fa-sign-in-alt mr-2"></i> Masuk
                </button>
            </form>
            
            <p class="text-center text-gray-500 mt-6">Belum punya akun? 
                <a href="#" onclick="showPage('registerPage')" class="text-purple-600 font-semibold hover:underline">Daftar</a>
            </p>
        </div>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="page min-h-screen flex items-center justify-center p-4 relative z-10">
        <div class="glass-card rounded-3xl p-8 max-w-md w-full relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500"></div>
            
            <button onclick="showPage('landingPage')" class="flex items-center gap-2 text-gray-500 hover:text-purple-600 mb-6 transition-colors">
                <i class="fas fa-arrow-left"></i>
                <span>Kembali</span>
            </button>
            
            <div class="text-center mb-8">
                <div class="w-16 h-16 mx-auto bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
                    <i class="fas fa-user-plus text-2xl text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Buat Akun Baru</h2>
                <p class="text-gray-500 mt-1">Isi data diri Anda</p>
            </div>
            
            <form id="registerForm" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-user text-green-500 mr-2"></i>Username
                    </label>
                    <input type="text" id="regUsername" required 
                        class="input-glow w-full px-5 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:bg-white outline-none transition-all duration-300" 
                        placeholder="Masukkan username">
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-lock text-green-500 mr-2"></i>Password
                    </label>
                    <div class="relative">
                        <input type="password" id="regPassword" required 
                            class="input-glow w-full px-5 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:bg-white outline-none transition-all duration-300" 
                            placeholder="Masukkan password">
                        <button type="button" onclick="togglePassword('regPassword', this)" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-green-500">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-calendar text-green-500 mr-2"></i>Usia
                        </label>
                        <input type="number" id="regAge" required min="1" max="120" 
                            class="input-glow w-full px-5 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:bg-white outline-none transition-all duration-300" 
                            placeholder="Usia">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-venus-mars text-green-500 mr-2"></i>Gender
                        </label>
                        <select id="regGender" required 
                            class="input-glow w-full px-5 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:bg-white outline-none transition-all duration-300">
                            <option value="">Pilih</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn-shine w-full py-4 px-6 bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500 text-white rounded-xl font-bold text-lg hover:shadow-xl hover:shadow-green-500/30 transition-all duration-300 mt-4">
                    <i class="fas fa-check-circle mr-2"></i> Daftar Sekarang
                </button>
            </form>
            
            <p class="text-center text-gray-500 mt-6">Sudah punya akun? 
                <a href="#" onclick="showPage('loginPage')" class="text-purple-600 font-semibold hover:underline">Masuk</a>
            </p>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page min-h-screen p-4 md:p-6 relative z-10">
        <div class="max-w-6xl mx-auto">
            
            <!-- Header -->
            <div class="glass rounded-2xl p-4 md:p-6 mb-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-violet-600 via-purple-600 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg glow-purple">
                            <i class="fas fa-user text-2xl text-white"></i>
                        </div>
                        <div class="text-white">
                            <h2 class="text-xl md:text-2xl font-bold" id="profileName">-</h2>
                            <p class="text-purple-200 flex items-center gap-2">
                                <span id="profileAge">-</span> tahun 
                                <span class="w-1.5 h-1.5 bg-purple-300 rounded-full"></span>
                                <span id="profileGender">-</span>
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 md:gap-3 flex-wrap justify-center">
                        <!-- Live Indicator -->
                        <div class="flex items-center gap-2 bg-white/10 px-3 py-2 rounded-full">
                            <div class="w-3 h-3 bg-green-400 rounded-full live-dot"></div>
                            <span class="text-white text-sm font-medium">Real-time</span>
                        </div>
                        <button onclick="showDeleteAccountModal()" class="px-4 py-2.5 bg-orange-500/80 hover:bg-orange-500 text-white rounded-xl transition-all duration-300 font-semibold flex items-center gap-2" title="Hapus Akun">
                            <i class="fas fa-user-times"></i>
                            <span class="hidden lg:inline">Hapus Akun</span>
                        </button>
                        <button onclick="logout()" class="px-4 py-2.5 bg-red-500/80 hover:bg-red-500 text-white rounded-xl transition-all duration-300 font-semibold flex items-center gap-2">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="hidden md:inline">Keluar</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Title Section -->
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-black text-white mb-2">
                    <i class="fas fa-chart-line mr-3"></i>Dashboard Monitoring
                </h1>
                <p class="text-purple-200 text-lg">Pantau kesehatan Anda secara real-time</p>
            </div>

            <!-- Sensor Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                
                <!-- BPM Card -->
                <div class="sensor-card glass-card rounded-3xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-red-500/20 to-pink-500/20 rounded-full blur-2xl"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <div class="w-14 h-14 bg-gradient-to-br from-red-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg glow-red">
                                <i class="fas fa-heartbeat text-2xl text-white heartbeat"></i>
                            </div>
                            <div id="bpmStatus" class="px-4 py-1.5 rounded-full text-xs font-bold text-white bg-gray-400">
                                MENUNGGU
                            </div>
                        </div>
                        
                        <h3 class="text-gray-500 text-sm font-medium mb-1">Detak Jantung</h3>
                        <div class="flex items-end gap-2 mb-4">
                            <p class="text-5xl font-black text-gray-800" id="bpmValue">0</p>
                            <span class="text-gray-400 text-xl font-bold mb-2">BPM</span>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                            <div id="bpmProgress" class="bg-gradient-to-r from-red-500 to-pink-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        
                        <div class="flex justify-between text-xs text-gray-400">
                            <span>40</span>
                            <span class="text-green-500 font-semibold">60-100 Normal</span>
                            <span>180</span>
                        </div>
                    </div>
                </div>

                <!-- SpO2 Card -->
                <div class="sensor-card glass-card rounded-3xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-500/20 to-cyan-500/20 rounded-full blur-2xl"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center shadow-lg glow-blue">
                                <i class="fas fa-lungs text-2xl text-white"></i>
                            </div>
                            <div id="spo2Status" class="px-4 py-1.5 rounded-full text-xs font-bold text-white bg-gray-400">
                                MENUNGGU
                            </div>
                        </div>
                        
                        <h3 class="text-gray-500 text-sm font-medium mb-1">Saturasi Oksigen</h3>
                        <div class="flex items-end gap-2 mb-4">
                            <p class="text-5xl font-black text-gray-800" id="spo2Value">0</p>
                            <span class="text-gray-400 text-xl font-bold mb-2">%</span>
                        </div>
                        
                        <!-- Circular Progress -->
                        <div class="flex items-center justify-between">
                            <div class="relative w-16 h-16">
                                <svg class="progress-ring w-16 h-16">
                                    <circle class="text-gray-200" stroke-width="4" stroke="currentColor" fill="transparent" r="28" cx="32" cy="32"/>
                                    <circle id="spo2Ring" class="progress-ring-circle text-blue-500" stroke-width="4" stroke="currentColor" fill="transparent" r="28" cx="32" cy="32" stroke-dasharray="175.93" stroke-dashoffset="175.93" stroke-linecap="round"/>
                                </svg>
                                <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-sm font-bold text-blue-500" id="spo2Percent">0%</span>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-400">Range Normal</p>
                                <p class="text-green-500 font-bold">95-100%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Temperature Card -->
                <div class="sensor-card glass-card rounded-3xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-orange-500/20 to-yellow-500/20 rounded-full blur-2xl"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <div class="w-14 h-14 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-2xl flex items-center justify-center shadow-lg glow-orange">
                                <i class="fas fa-thermometer-half text-2xl text-white"></i>
                            </div>
                            <div id="tempStatus" class="px-4 py-1.5 rounded-full text-xs font-bold text-white bg-gray-400">
                                MENUNGGU
                            </div>
                        </div>
                        
                        <h3 class="text-gray-500 text-sm font-medium mb-1">Suhu Tubuh</h3>
                        <div class="flex items-end gap-2 mb-4">
                            <p class="text-5xl font-black text-gray-800" id="tempValue">0</p>
                            <span class="text-gray-400 text-xl font-bold mb-2">°C</span>
                        </div>
                        
                        <!-- Thermometer Visual -->
                        <div class="flex items-center gap-4">
                            <div class="flex-1 bg-gray-200 rounded-full h-4 relative overflow-hidden">
                                <div id="tempProgress" class="absolute left-0 top-0 h-full bg-gradient-to-r from-blue-400 via-green-400 to-red-500 transition-all duration-500" style="width: 0%"></div>
                                <div class="absolute left-[36%] top-0 bottom-0 w-0.5 bg-white/50"></div>
                                <div class="absolute left-[50%] top-0 bottom-0 w-0.5 bg-white/50"></div>
                            </div>
                            <span class="text-sm font-bold text-gray-500">36-37°C</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Refresh Button -->
            <div class="text-center mb-8">
                <button onclick="fetchSensorData()" id="refreshBtn" class="btn-shine group px-10 py-5 bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600 text-white rounded-2xl font-bold text-lg hover:shadow-2xl hover:shadow-purple-500/40 transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-sync-alt mr-3 group-hover:animate-spin"></i>
                    Ambil Data Sensor
                </button>
                <p class="text-purple-200 text-sm mt-3">
                    <i class="fas fa-info-circle mr-1"></i>
                    Tekan untuk mengambil data terbaru dari sensor
                </p>
            </div>

            <!-- Auto Refresh Toggle -->
            <div class="glass rounded-2xl p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-clock text-green-400"></i>
                        </div>
                        <div>
                            <p class="text-white font-semibold">Auto Refresh</p>
                            <p class="text-purple-200 text-sm">Update data otomatis setiap 5 detik</p>
                        </div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="autoRefreshToggle" class="sr-only peer">
                        <div class="w-14 h-7 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                </div>
            </div>

            <!-- History Section -->
            <div class="glass rounded-2xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white flex items-center gap-3">
                        <i class="fas fa-history text-purple-300"></i>
                        Riwayat Pengukuran
                    </h3>
                    <div class="flex items-center gap-3">
                        <button onclick="loadHistory()" class="text-purple-300 hover:text-white transition-colors" title="Refresh">
                            <i class="fas fa-refresh"></i>
                        </button>
                        <button onclick="showDeleteHistoryModal()" class="text-red-400 hover:text-red-300 transition-colors flex items-center gap-2 bg-red-500/20 px-3 py-1.5 rounded-lg" title="Hapus Semua Riwayat">
                            <i class="fas fa-trash-alt"></i>
                            <span class="text-sm font-medium hidden sm:inline">Hapus Semua</span>
                        </button>
                    </div>
                </div>
                
                <div id="historyList" class="space-y-3 max-h-80 overflow-y-auto pr-2">
                    <div class="text-center py-8">
                        <i class="fas fa-clipboard-list text-4xl text-purple-300/50 mb-3"></i>
                        <p class="text-purple-200">Belum ada riwayat pengukuran</p>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="text-center mt-8 text-purple-200/60 text-sm">
                <p>© 2024 HEMOS - Healthy Monitoring System</p>
                <p class="mt-1">Powered by IoT & Firebase</p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 px-6 py-4 rounded-2xl shadow-2xl transform translate-y-20 opacity-0 transition-all duration-500 z-50 flex items-center gap-3">
        <i id="toastIcon" class="fas fa-check-circle text-xl"></i>
        <p id="toastMessage" class="text-white font-medium"></p>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center">
        <div class="glass-card rounded-2xl p-8 text-center">
            <div class="w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-700 font-medium">Memuat data...</p>
        </div>
    </div>

    <!-- Delete Account Modal -->
    <div id="deleteAccountModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="glass-card rounded-3xl p-8 max-w-md w-full relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-500 via-orange-500 to-red-500"></div>
            
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto bg-gradient-to-br from-red-500 to-orange-500 rounded-full flex items-center justify-center mb-4 shadow-lg">
                    <i class="fas fa-exclamation-triangle text-3xl text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Hapus Akun?</h2>
                <p class="text-gray-500 mt-2">Tindakan ini tidak dapat dibatalkan. Semua data Anda akan dihapus permanen.</p>
            </div>
            
            <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
                <p class="text-red-600 text-sm"><i class="fas fa-info-circle mr-2"></i>Masukkan password Anda untuk konfirmasi:</p>
                <input type="password" id="deleteAccountPassword" class="w-full mt-3 px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-500 outline-none" placeholder="Password Anda">
            </div>
            
            <div class="flex gap-3">
                <button onclick="hideDeleteAccountModal()" class="flex-1 py-3 px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl font-semibold transition-all">
                    <i class="fas fa-times mr-2"></i>Batal
                </button>
                <button onclick="deleteAccount()" class="flex-1 py-3 px-4 bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white rounded-xl font-semibold transition-all">
                    <i class="fas fa-trash-alt mr-2"></i>Hapus Akun
                </button>
            </div>
        </div>
    </div>

    <!-- Delete History Modal -->
    <div id="deleteHistoryModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="glass-card rounded-3xl p-8 max-w-md w-full relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-500 via-yellow-500 to-orange-500"></div>
            
            <div class="text-center mb-6">
                <div class="w-20 h-20 mx-auto bg-gradient-to-br from-orange-500 to-yellow-500 rounded-full flex items-center justify-center mb-4 shadow-lg">
                    <i class="fas fa-history text-3xl text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Hapus Semua Riwayat?</h2>
                <p class="text-gray-500 mt-2">Semua riwayat pengukuran Anda akan dihapus permanen dan tidak dapat dikembalikan.</p>
            </div>
            
            <div class="flex gap-3">
                <button onclick="hideDeleteHistoryModal()" class="flex-1 py-3 px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl font-semibold transition-all">
                    <i class="fas fa-times mr-2"></i>Batal
                </button>
                <button onclick="deleteAllHistory()" class="flex-1 py-3 px-4 bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white rounded-xl font-semibold transition-all">
                    <i class="fas fa-trash-alt mr-2"></i>Hapus Semua
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBR8MD4D8r9tCemiEIHqUbh3_8FOMT77aU",
            databaseURL: "https://hemozz-default-rtdb.firebaseio.com/"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Current user & auto refresh
        let currentUser = null;
        let autoRefreshInterval = null;

        // Create Floating Particles
        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = Math.random() * 10 + 10 + 's';
                container.appendChild(particle);
            }
        }

        // Show page function
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        // Toggle password visibility
        function togglePassword(inputId, btn) {
            const input = document.getElementById(inputId);
            const icon = btn.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            
            toastMessage.textContent = message;
            
            if (type === 'success') {
                toast.className = 'fixed bottom-6 right-6 px-6 py-4 rounded-2xl shadow-2xl transform transition-all duration-500 z-50 flex items-center gap-3 bg-gradient-to-r from-green-500 to-emerald-500';
                toastIcon.className = 'fas fa-check-circle text-xl text-white';
            } else {
                toast.className = 'fixed bottom-6 right-6 px-6 py-4 rounded-2xl shadow-2xl transform transition-all duration-500 z-50 flex items-center gap-3 bg-gradient-to-r from-red-500 to-pink-500';
                toastIcon.className = 'fas fa-exclamation-circle text-xl text-white';
            }
            
            toast.classList.remove('translate-y-20', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3500);
        }

        // Show/Hide loading
        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        // Register form handler
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading(true);
            
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const age = document.getElementById('regAge').value;
            const gender = document.getElementById('regGender').value;

            try {
                const snapshot = await database.ref('users/' + username).once('value');
                if (snapshot.exists()) {
                    showToast('Username sudah digunakan!', 'error');
                    showLoading(false);
                    return;
                }

                await database.ref('users/' + username).set({
                    username, password, age, gender,
                    createdAt: new Date().toISOString()
                });

                showToast('Pendaftaran berhasil! Silakan login.');
                document.getElementById('registerForm').reset();
                showPage('loginPage');
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            showLoading(false);
        });

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading(true);
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            try {
                const snapshot = await database.ref('users/' + username).once('value');
                if (!snapshot.exists()) {
                    showToast('Username tidak ditemukan!', 'error');
                    showLoading(false);
                    return;
                }

                const userData = snapshot.val();
                if (userData.password !== password) {
                    showToast('Password salah!', 'error');
                    showLoading(false);
                    return;
                }

                currentUser = userData;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                showToast('Login berhasil! Selamat datang ' + currentUser.username);
                document.getElementById('loginForm').reset();
                loadDashboard();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            showLoading(false);
        });

        // Load dashboard
        function loadDashboard() {
            document.getElementById('profileName').textContent = currentUser.username;
            document.getElementById('profileAge').textContent = currentUser.age;
            document.getElementById('profileGender').textContent = currentUser.gender;
            
            // Reset sensor values to 0 - SELALU reset saat login/reload
            resetSensorDisplay();
            
            // Reset auto refresh toggle
            document.getElementById('autoRefreshToggle').checked = false;
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
            
            showPage('dashboardPage');
            loadHistory();
            
            // TIDAK menggunakan realtime listener agar nilai tetap 0 sampai tombol ditekan
        }

        // Reset sensor display to 0 - dipanggil saat login, reload, atau logout
        function resetSensorDisplay() {
            // BPM - reset ke 0
            document.getElementById('bpmValue').textContent = '0';
            document.getElementById('bpmStatus').textContent = 'MENUNGGU';
            document.getElementById('bpmStatus').className = 'px-4 py-1.5 rounded-full text-xs font-bold text-white bg-gray-400';
            document.getElementById('bpmProgress').style.width = '0%';
            
            // SpO2 - reset ke 0
            document.getElementById('spo2Value').textContent = '0';
            document.getElementById('spo2Status').textContent = 'MENUNGGU';
            document.getElementById('spo2Status').className = 'px-4 py-1.5 rounded-full text-xs font-bold text-white bg-gray-400';
            document.getElementById('spo2Ring').style.strokeDashoffset = '175.93';
            document.getElementById('spo2Percent').textContent = '0%';
            
            // Temperature - reset ke 0
            document.getElementById('tempValue').textContent = '0';
            document.getElementById('tempStatus').textContent = 'MENUNGGU';
            document.getElementById('tempStatus').className = 'px-4 py-1.5 rounded-full text-xs font-bold text-white bg-gray-400';
            document.getElementById('tempProgress').style.width = '0%';
        }

        // Logout function
        function logout() {
            // Reset semua sensor ke 0
            resetSensorDisplay();
            
            currentUser = null;
            localStorage.removeItem('currentUser');
            
            // Matikan auto refresh jika aktif
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
            
            // Matikan semua listener Firebase
            database.ref('sensors').off();
            
            showPage('landingPage');
            showToast('Berhasil keluar');
        }

        // Get status based on sensor type and value
        function getStatus(type, value, arduinoStatus = null) {
            // Jika Arduino mengirim status, gunakan itu
            if (arduinoStatus) {
                const statusLower = arduinoStatus.toLowerCase();
                if (statusLower.includes('normal')) return { text: 'NORMAL', class: 'status-normal' };
                if (statusLower.includes('rendah') || statusLower.includes('low')) return { text: 'RENDAH', class: 'status-low' };
                if (statusLower.includes('tinggi') || statusLower.includes('high')) return { text: 'TINGGI', class: 'status-high' };
            }
            
            // Fallback ke logika manual
            if (type === 'bpm') {
                if (value < 60) return { text: 'RENDAH', class: 'status-low' };
                if (value > 100) return { text: 'TINGGI', class: 'status-high' };
                return { text: 'NORMAL', class: 'status-normal' };
            } else if (type === 'spo2') {
                if (value < 90) return { text: 'KRITIS', class: 'status-high' };
                if (value < 95) return { text: 'RENDAH', class: 'status-low' };
                return { text: 'NORMAL', class: 'status-normal' };
            } else if (type === 'suhu' || type === 'temp') {
                if (value < 36.1) return { text: 'RENDAH', class: 'status-low' };
                if (value > 37.5) return { text: 'TINGGI', class: 'status-high' };
                return { text: 'NORMAL', class: 'status-normal' };
            }
            return { text: 'NORMAL', class: 'status-normal' };
        }

        // Update sensor display with data from Firebase
        function updateSensorDisplay(data) {
            // BPM
            if (data.bpm || data.BPM) {
                const bpmData = data.bpm || data.BPM;
                const bpmValue = typeof bpmData === 'object' ? bpmData.value : bpmData;
                const bpmStatus = typeof bpmData === 'object' ? getStatus('bpm', bpmValue, bpmData.status) : getStatus('bpm', bpmValue);
                
                document.getElementById('bpmValue').textContent = Math.round(bpmValue);
                document.getElementById('bpmStatus').textContent = bpmStatus.text;
                document.getElementById('bpmStatus').className = `px-4 py-1.5 rounded-full text-xs font-bold text-white ${bpmStatus.class}`;
                
                // Progress bar (40-180 range)
                const bpmPercent = Math.min(100, Math.max(0, ((bpmValue - 40) / 140) * 100));
                document.getElementById('bpmProgress').style.width = bpmPercent + '%';
            }

            // SpO2 - Support multiple key names: spo2, SPO2, SpO2
            const spo2Key = data.spo2 || data.SPO2 || data.SpO2 || data.Spo2;
            if (spo2Key) {
                const spo2Data = spo2Key;
                const spo2Value = typeof spo2Data === 'object' ? spo2Data.value : spo2Data;
                const spo2Status = typeof spo2Data === 'object' ? getStatus('spo2', spo2Value, spo2Data.status) : getStatus('spo2', spo2Value);
                
                document.getElementById('spo2Value').textContent = Math.round(spo2Value);
                document.getElementById('spo2Status').textContent = spo2Status.text;
                document.getElementById('spo2Status').className = `px-4 py-1.5 rounded-full text-xs font-bold text-white ${spo2Status.class}`;
                
                // Circular progress
                const spo2Percent = Math.min(100, Math.max(0, spo2Value));
                const circumference = 2 * Math.PI * 28;
                const offset = circumference - (spo2Percent / 100 * circumference);
                document.getElementById('spo2Ring').style.strokeDashoffset = offset;
                document.getElementById('spo2Percent').textContent = Math.round(spo2Value) + '%';
            }

            // Temperature/Suhu
            if (data.suhu || data.temp || data.Suhu || data.temperature) {
                const tempData = data.suhu || data.temp || data.Suhu || data.temperature;
                const tempValue = typeof tempData === 'object' ? tempData.value : tempData;
                const tempStatus = typeof tempData === 'object' ? getStatus('suhu', tempValue, tempData.status) : getStatus('suhu', tempValue);
                
                document.getElementById('tempValue').textContent = parseFloat(tempValue).toFixed(1);
                document.getElementById('tempStatus').textContent = tempStatus.text;
                document.getElementById('tempStatus').className = `px-4 py-1.5 rounded-full text-xs font-bold text-white ${tempStatus.class}`;
                
                // Temperature progress (34-42 range)
                const tempPercent = Math.min(100, Math.max(0, ((tempValue - 34) / 8) * 100));
                document.getElementById('tempProgress').style.width = tempPercent + '%';
            }
        }

        // Fetch sensor data manually
        async function fetchSensorData() {
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-sync-alt mr-3 animate-spin"></i> Mengambil Data...';

            try {
                const snapshot = await database.ref('sensors').once('value');
                const sensorData = snapshot.val();

                if (sensorData) {
                    updateSensorDisplay(sensorData);
                    
                    // Extract values for history - support multiple key formats
                    const bpmData = sensorData.bpm || sensorData.BPM;
                    const bpm = typeof bpmData === 'object' ? bpmData.value : bpmData || 0;
                    
                    const spo2Data = sensorData.spo2 || sensorData.SPO2 || sensorData.SpO2 || sensorData.Spo2;
                    const spo2 = typeof spo2Data === 'object' ? spo2Data.value : spo2Data || 0;
                    
                    const tempData = sensorData.suhu || sensorData.temp || sensorData.Suhu || sensorData.temperature;
                    const temp = typeof tempData === 'object' ? tempData.value : tempData || 0;

                    // Save to history
                    await saveToHistory(bpm, spo2, temp);
                    showToast('Data berhasil diperbarui!');
                } else {
                    showToast('Tidak ada data dari sensor!', 'error');
                }
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }

            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-sync-alt mr-3"></i> Ambil Data Sensor';
        }

        // Save to history
        async function saveToHistory(bpm, spo2, temp) {
            if (!currentUser) return;

            await database.ref('history/' + currentUser.username).push({
                bpm: bpm,
                spo2: spo2,
                temp: temp,
                timestamp: new Date().toISOString()
            });

            loadHistory();
        }

        // Load history
        async function loadHistory() {
            if (!currentUser) return;

            const historyList = document.getElementById('historyList');
            
            try {
                const snapshot = await database.ref('history/' + currentUser.username).orderByChild('timestamp').limitToLast(15).once('value');
                const history = snapshot.val();

                if (!history) {
                    historyList.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-clipboard-list text-4xl text-purple-300/50 mb-3"></i>
                            <p class="text-purple-200">Belum ada riwayat pengukuran</p>
                        </div>
                    `;
                    return;
                }

                const entries = Object.entries(history).reverse();
                historyList.innerHTML = entries.map(([key, data], index) => {
                    const date = new Date(data.timestamp);
                    const formattedDate = date.toLocaleDateString('id-ID', { 
                        day: '2-digit', month: 'short', year: 'numeric',
                        hour: '2-digit', minute: '2-digit'
                    });
                    
                    const bpmStatus = getStatus('bpm', data.bpm);
                    const spo2Status = getStatus('spo2', data.spo2);
                    const tempStatus = getStatus('suhu', data.temp);
                    
                    return `
                        <div class="bg-white/10 hover:bg-white/20 rounded-xl p-4 transition-all duration-300 ${index === 0 ? 'ring-2 ring-purple-400' : ''}">
                            <div class="flex justify-between items-start mb-3">
                                <p class="text-purple-200 text-sm flex items-center gap-2">
                                    <i class="fas fa-clock"></i>
                                    ${formattedDate}
                                </p>
                                ${index === 0 ? '<span class="bg-purple-500 text-white text-xs px-2 py-1 rounded-full">Terbaru</span>' : ''}
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="flex items-center justify-center gap-1 mb-1">
                                        <i class="fas fa-heart text-red-400 text-xs"></i>
                                        <span class="text-white font-bold">${Math.round(data.bpm)}</span>
                                    </div>
                                    <span class="text-xs text-gray-400">BPM</span>
                                </div>
                                <div class="text-center">
                                    <div class="flex items-center justify-center gap-1 mb-1">
                                        <i class="fas fa-lungs text-blue-400 text-xs"></i>
                                        <span class="text-white font-bold">${Math.round(data.spo2)}%</span>
                                    </div>
                                    <span class="text-xs text-gray-400">SpO2</span>
                                </div>
                                <div class="text-center">
                                    <div class="flex items-center justify-center gap-1 mb-1">
                                        <i class="fas fa-thermometer-half text-orange-400 text-xs"></i>
                                        <span class="text-white font-bold">${parseFloat(data.temp).toFixed(1)}°</span>
                                    </div>
                                    <span class="text-xs text-gray-400">Suhu</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }

        // Auto refresh toggle
        document.getElementById('autoRefreshToggle').addEventListener('change', function() {
            if (this.checked) {
                // Langsung ambil data pertama kali, lalu setiap 5 detik
                fetchSensorData();
                autoRefreshInterval = setInterval(fetchSensorData, 5000);
                showToast('Auto refresh diaktifkan - Data akan diperbarui setiap 5 detik');
            } else {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
                // Reset display ke 0 saat auto refresh dimatikan
                resetSensorDisplay();
                showToast('Auto refresh dinonaktifkan - Data direset ke 0');
            }
        });

        // Show delete account modal
        function showDeleteAccountModal() {
            document.getElementById('deleteAccountModal').style.display = 'flex';
            document.getElementById('deleteAccountPassword').value = '';
        }

        // Hide delete account modal
        function hideDeleteAccountModal() {
            document.getElementById('deleteAccountModal').style.display = 'none';
        }

        // Delete account
        async function deleteAccount() {
            const password = document.getElementById('deleteAccountPassword').value;
            
            if (!password) {
                showToast('Masukkan password untuk konfirmasi!', 'error');
                return;
            }
            
            if (password !== currentUser.password) {
                showToast('Password salah!', 'error');
                return;
            }
            
            showLoading(true);
            hideDeleteAccountModal();
            
            try {
                // Delete user data
                await database.ref('users/' + currentUser.username).remove();
                
                // Delete user history
                await database.ref('history/' + currentUser.username).remove();
                
                showToast('Akun berhasil dihapus!');
                
                // Logout
                currentUser = null;
                localStorage.removeItem('currentUser');
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
                database.ref('sensors').off();
                showPage('landingPage');
                
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            
            showLoading(false);
        }

        // Show delete history modal
        function showDeleteHistoryModal() {
            document.getElementById('deleteHistoryModal').style.display = 'flex';
        }

        // Hide delete history modal
        function hideDeleteHistoryModal() {
            document.getElementById('deleteHistoryModal').style.display = 'none';
        }

        // Delete all history
        async function deleteAllHistory() {
            if (!currentUser) return;
            
            showLoading(true);
            hideDeleteHistoryModal();
            
            try {
                await database.ref('history/' + currentUser.username).remove();
                
                showToast('Semua riwayat berhasil dihapus!');
                loadHistory();
                
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            
            showLoading(false);
        }

        // Initialize on page load
        window.onload = function() {
            createParticles();
            
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                // Load dashboard dengan nilai sensor direset ke 0
                loadDashboard();
            }
        };
        
        // Reset juga saat halaman di-refresh/reload
        window.onbeforeunload = function() {
            // Matikan listener dan auto refresh
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            database.ref('sensors').off();
        };
    </script>
</body>
</html>
